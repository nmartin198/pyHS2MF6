
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>4.2.1. Main Block &#8212; pyHS2MF6 0.1.1 documentation</title>
    <link rel="stylesheet" href="_static/agogo.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="4.2.2. RCHRES Water Movement and Storage" href="mHSP2_hrchhyd.html" />
    <link rel="prev" title="4.2. mHSP2" href="mHSP2.html" /> 
  </head><body>
    <div class="header-wrapper" role="banner">
      <div class="header">
        <div class="headertitle"><a
          href="index.html">pyHS2MF6 0.1.1 documentation</a></div>
        <div class="rel" role="navigation" aria-label="related navigation">
          <a href="mHSP2.html" title="4.2. mHSP2"
             accesskey="P">previous</a> |
          <a href="mHSP2_hrchhyd.html" title="4.2.2. RCHRES Water Movement and Storage"
             accesskey="N">next</a> |
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |
          <a href="f-modindex.html" title="Fortran Module Index"
             >fortran modules</a> |
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a>
        </div>
       </div>
    </div>

    <div class="content-wrapper">
      <div class="content">
        <div class="document">
            
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="main-block">
<span id="mhsp2-main"></span><h1><span class="section-number">4.2.1. </span>Main Block<a class="headerlink" href="#main-block" title="Permalink to this headline">¶</a></h1>
<p>Replaces the main module in <em>HSPsquared</em> and provides for the outermost
level of <strong>mHSP2</strong> functionality.</p>
<div class="section" id="module-locaMain">
<span id="locamain-py"></span><span id="mhsp2-locamain-py"></span><h2><span class="section-number">4.2.1.1. </span>locaMain.py<a class="headerlink" href="#module-locaMain" title="Permalink to this headline">¶</a></h2>
<p>The main block for mHSP2 which is a replacement for <em>HSPsquared</em> main.</p>
<p><em>HSPsquared</em> (HSP2) was completely modified and rearranged to create a
main time loop with a sub-loop of operations/targets. The original HSPF
logic is a main-loop of operations/targets and then a sub-loop for each
target that is the time loop. Consequently, the time loop is run
completely for each operation and target.</p>
<p>To couple HSPF to MODFLOW6, need to be able to break into the time loop
at the beginning of each day. This Python module provides the replacement
for HSP2main.py for coupling to MODFLOW 6. There are two main time loop
versions within this module. The user controls which version is run by
executing <code class="docutils literal notranslate"><span class="pre">..\coupledMain.py</span></code> or <code class="docutils literal notranslate"><span class="pre">..\standaloneMain.py.</span></code> Both “mains”
use functions within this module. Function <em>salocaMain</em> is for standalone
execution, and functions <em>setUPPreTL</em> and <em>mainTL</em> are for coupled
(to MODFLOW 6) execution.</p>
<p>The message passing queue functions are only used when coupled mode
execution is requested. Also the main block (<code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">__name__</span> <span class="pre">==</span> <span class="pre">main():</span></code>)
in this module is what is launcehd to start the independent process,
spawned by the coupled controller and queue manager.</p>
<dl class="py data">
<dt id="locaMain.AUTHKEY">
<code class="sig-prename descclassname">locaMain.</code><code class="sig-name descname">AUTHKEY</code><em class="property"> = b'authkey'</em><a class="headerlink" href="#locaMain.AUTHKEY" title="Permalink to this definition">¶</a></dt>
<dd><p>Authorization key for queue access.</p>
<p>This is not currently setup in a secure manner. If you plan on using
pyHS2MF6 across a public or partially public network, then you should
give some thought to the AUTHKEY and a means of securing this value.
AUTHKEY needs to be encoded to a byte string.</p>
</dd></dl>

<dl class="py data">
<dt id="locaMain.CLIENTHOST">
<code class="sig-prename descclassname">locaMain.</code><code class="sig-name descname">CLIENTHOST</code><em class="property"> = '127.0.0.1'</em><a class="headerlink" href="#locaMain.CLIENTHOST" title="Permalink to this definition">¶</a></dt>
<dd><p>Host machine for queue clients.</p>
<p>Clients are on the same ‘machine’ as the queue server when local
descriptors like ‘localhost’ or ‘127.0.0.1’ are used.</p>
</dd></dl>

<dl class="py data">
<dt id="locaMain.DAILY_DELT_STR">
<code class="sig-prename descclassname">locaMain.</code><code class="sig-name descname">DAILY_DELT_STR</code><em class="property"> = '1440'</em><a class="headerlink" href="#locaMain.DAILY_DELT_STR" title="Permalink to this definition">¶</a></dt>
<dd><p>DELT string representing daily, 24 hours * 60 minutes</p>
</dd></dl>

<dl class="py data">
<dt id="locaMain.GFTAB_DICT">
<code class="sig-prename descclassname">locaMain.</code><code class="sig-name descname">GFTAB_DICT</code><em class="property"> = {}</em><a class="headerlink" href="#locaMain.GFTAB_DICT" title="Permalink to this definition">¶</a></dt>
<dd><p>Global FTABLE dictionary that stores the FTABLEs by FTABLE number</p>
</dd></dl>

<dl class="py data">
<dt id="locaMain.GTS_DICT">
<code class="sig-prename descclassname">locaMain.</code><code class="sig-name descname">GTS_DICT</code><em class="property"> = {}</em><a class="headerlink" href="#locaMain.GTS_DICT" title="Permalink to this definition">¶</a></dt>
<dd><p>Global time series dictionary that stores the time series by SVOLNO
key</p>
</dd></dl>

<dl class="py data">
<dt id="locaMain.HOST">
<code class="sig-prename descclassname">locaMain.</code><code class="sig-name descname">HOST</code><em class="property"> = 'localhost'</em><a class="headerlink" href="#locaMain.HOST" title="Permalink to this definition">¶</a></dt>
<dd><p>Host machine for queue server.</p>
<p>Localhost means that the process are set-up to be on all the same
machine. The queue server and the clients are in different processes
on the same ‘machine’.</p>
</dd></dl>

<dl class="py data">
<dt id="locaMain.KEY_ACT_IWAT">
<code class="sig-prename descclassname">locaMain.</code><code class="sig-name descname">KEY_ACT_IWAT</code><em class="property"> = 'IWATFG'</em><a class="headerlink" href="#locaMain.KEY_ACT_IWAT" title="Permalink to this definition">¶</a></dt>
<dd><p>Key value for simulating standard impervious water runoff</p>
</dd></dl>

<dl class="py data">
<dt id="locaMain.KEY_ACT_PWAT">
<code class="sig-prename descclassname">locaMain.</code><code class="sig-name descname">KEY_ACT_PWAT</code><em class="property"> = 'PWATFG'</em><a class="headerlink" href="#locaMain.KEY_ACT_PWAT" title="Permalink to this definition">¶</a></dt>
<dd><p>Key value for simulating standard pervious water runoff</p>
</dd></dl>

<dl class="py data">
<dt id="locaMain.KEY_ACT_RRHYD">
<code class="sig-prename descclassname">locaMain.</code><code class="sig-name descname">KEY_ACT_RRHYD</code><em class="property"> = 'HYDRFG'</em><a class="headerlink" href="#locaMain.KEY_ACT_RRHYD" title="Permalink to this definition">¶</a></dt>
<dd><p>Key value for simulating HYDR portion of reach reservoirs</p>
</dd></dl>

<dl class="py data">
<dt id="locaMain.KEY_TS_PET">
<code class="sig-prename descclassname">locaMain.</code><code class="sig-name descname">KEY_TS_PET</code><em class="property"> = 'PETINP'</em><a class="headerlink" href="#locaMain.KEY_TS_PET" title="Permalink to this definition">¶</a></dt>
<dd><p>External time series key for input PET</p>
</dd></dl>

<dl class="py data">
<dt id="locaMain.KEY_TS_PRECIP">
<code class="sig-prename descclassname">locaMain.</code><code class="sig-name descname">KEY_TS_PRECIP</code><em class="property"> = 'PREC'</em><a class="headerlink" href="#locaMain.KEY_TS_PRECIP" title="Permalink to this definition">¶</a></dt>
<dd><p>External time series key for precipitation</p>
</dd></dl>

<dl class="py data">
<dt id="locaMain.MAP_TS_DICT">
<code class="sig-prename descclassname">locaMain.</code><code class="sig-name descname">MAP_TS_DICT</code><em class="property"> = {}</em><a class="headerlink" href="#locaMain.MAP_TS_DICT" title="Permalink to this definition">¶</a></dt>
<dd><p>Dictionary to map solution structure to time series.</p>
<p>Keys, tuple of (solution type, ID), and values [ SVOLNO, TMEMN, TVOLNO]</p>
</dd></dl>

<dl class="py data">
<dt id="locaMain.PORT0">
<code class="sig-prename descclassname">locaMain.</code><code class="sig-name descname">PORT0</code><em class="property"> = 45492</em><a class="headerlink" href="#locaMain.PORT0" title="Permalink to this definition">¶</a></dt>
<dd><p>Port number for the HSP2 queue.</p>
<p>Port numbers for queues need to be the same for each independent process
for connection. Additionally, ports need to be opened in any firewall
software even for local simulation.</p>
</dd></dl>

<dl class="py data">
<dt id="locaMain.PORT1">
<code class="sig-prename descclassname">locaMain.</code><code class="sig-name descname">PORT1</code><em class="property"> = 45493</em><a class="headerlink" href="#locaMain.PORT1" title="Permalink to this definition">¶</a></dt>
<dd><p>Port number for the MODFLOW 6 queue.</p>
<p>Port numbers for queues need to be the same for each independent process
for connection. Additionally, ports need to be opened in any firewall
software even for local simulation.</p>
</dd></dl>

<dl class="py data">
<dt id="locaMain.PORT2">
<code class="sig-prename descclassname">locaMain.</code><code class="sig-name descname">PORT2</code><em class="property"> = 45494</em><a class="headerlink" href="#locaMain.PORT2" title="Permalink to this definition">¶</a></dt>
<dd><p>Port number for global error handling and communications queue.</p>
<p>Port numbers for queues need to be the same for each independent process
for connection. Additionally, ports need to be opened in any firewall
software even for local simulation.</p>
</dd></dl>

<dl class="py data">
<dt id="locaMain.QEND_MSG">
<code class="sig-prename descclassname">locaMain.</code><code class="sig-name descname">QEND_MSG</code><em class="property"> = ['End']</em><a class="headerlink" href="#locaMain.QEND_MSG" title="Permalink to this definition">¶</a></dt>
<dd><p>End of simulation message</p>
</dd></dl>

<dl class="py data">
<dt id="locaMain.QINIT_MSG">
<code class="sig-prename descclassname">locaMain.</code><code class="sig-name descname">QINIT_MSG</code><em class="property"> = ['Hello']</em><a class="headerlink" href="#locaMain.QINIT_MSG" title="Permalink to this definition">¶</a></dt>
<dd><p>Queue intialization and checkin message</p>
</dd></dl>

<dl class="py data">
<dt id="locaMain.QREADY_MSG">
<code class="sig-prename descclassname">locaMain.</code><code class="sig-name descname">QREADY_MSG</code><em class="property"> = ['Ready']</em><a class="headerlink" href="#locaMain.QREADY_MSG" title="Permalink to this definition">¶</a></dt>
<dd><p>Queue intialization and checkin message</p>
</dd></dl>

<dl class="py data">
<dt id="locaMain.QUEUE_ERROR">
<code class="sig-prename descclassname">locaMain.</code><code class="sig-name descname">QUEUE_ERROR</code><em class="property"> = ['Error']</em><a class="headerlink" href="#locaMain.QUEUE_ERROR" title="Permalink to this definition">¶</a></dt>
<dd><p>Error message to put on queues for program termination</p>
</dd></dl>

<dl class="py data">
<dt id="locaMain.QUEUE_TIMEOUT">
<code class="sig-prename descclassname">locaMain.</code><code class="sig-name descname">QUEUE_TIMEOUT</code><em class="property"> = 300.0</em><a class="headerlink" href="#locaMain.QUEUE_TIMEOUT" title="Permalink to this definition">¶</a></dt>
<dd><p>Queue wait timeout before error in seconds.</p>
<p>This is for the from pyMF6 queue and determines the mHSP2 wait time
for receipt from MODFLOW 6.</p>
</dd></dl>

<dl class="py class">
<dt id="locaMain.QueueManager">
<em class="property">class </em><code class="sig-prename descclassname">locaMain.</code><code class="sig-name descname">QueueManager</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">address</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">authkey</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">serializer</span><span class="o">=</span><span class="default_value">'pickle'</span></em>, <em class="sig-param"><span class="n">ctx</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#locaMain.QueueManager" title="Permalink to this definition">¶</a></dt>
<dd><p>Create the queue manager class.</p>
<p>Needs to be at top level of the module so that is pickleable. Do not
need anything here except to subclass SyncManager.</p>
</dd></dl>

<dl class="py function">
<dt id="locaMain.QueueServerClient">
<code class="sig-prename descclassname">locaMain.</code><code class="sig-name descname">QueueServerClient</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">ThisHost</span></em>, <em class="sig-param"><span class="n">Porter</span></em>, <em class="sig-param"><span class="n">CustomAuth</span></em><span class="sig-paren">)</span><a class="headerlink" href="#locaMain.QueueServerClient" title="Permalink to this definition">¶</a></dt>
<dd><p>Get a client connection a queue.</p>
<p>The connection is bidirectional and can use this connection for both get
and put.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ThisHost</strong> (<em>str</em>) – host name. Should be ‘127.0.0.1’ for the same machine</p></li>
<li><p><strong>Porter</strong> (<em>int</em>) – the port number to listen on</p></li>
<li><p><strong>CustomAuth</strong> (<em>str</em>) – the custom authorization string</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the client connection</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference internal" href="#locaMain.QueueManager" title="locaMain.QueueManager">locaMain.QueueManager</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py data">
<dt id="locaMain.SEQUENCE_DICT">
<code class="sig-prename descclassname">locaMain.</code><code class="sig-name descname">SEQUENCE_DICT</code><em class="property"> = {'IMPLND': [[100, 'ATMPFG'], [200, 'SNOWFG'], [300, ['IWATFG', 'IWATER']]], 'PERLND': [[100, 'AIRTFG'], [200, 'SNOWFG'], [300, ['PWATFG', 'PWATER']]], 'RCHRES': [[100, ['HYDRFG', 'HYDR']]]}</em><a class="headerlink" href="#locaMain.SEQUENCE_DICT" title="Permalink to this definition">¶</a></dt>
<dd><p>Holds the required calculation sequence by supported target type.</p>
<p>In HSPsquared, this is read in from the HDF5 file. Anyone can change
edit the HDF5 file which opens the possibility of unintentional
breakage of the program through incorrect editing of a portion of
the HDF5 file. Consequently, this is hard coded here because to
modify this sequence successfully, the code needs to be modified.</p>
</dd></dl>

<dl class="py data">
<dt id="locaMain.SIMTIME_INDEXES">
<code class="sig-prename descclassname">locaMain.</code><code class="sig-name descname">SIMTIME_INDEXES</code><em class="property"> = {}</em><a class="headerlink" href="#locaMain.SIMTIME_INDEXES" title="Permalink to this definition">¶</a></dt>
<dd><p>Dictionary that holds simulation time indexes in case they happen
to be different</p>
</dd></dl>

<dl class="py data">
<dt id="locaMain.START_QUEUE_TO">
<code class="sig-prename descclassname">locaMain.</code><code class="sig-name descname">START_QUEUE_TO</code><em class="property"> = 300.0</em><a class="headerlink" href="#locaMain.START_QUEUE_TO" title="Permalink to this definition">¶</a></dt>
<dd><p>Queue wait timeout before error in seconds.</p>
<p>This is for program startup communications.</p>
</dd></dl>

<dl class="py data">
<dt id="locaMain.SUPPORTED_ACTIVITIES">
<code class="sig-prename descclassname">locaMain.</code><code class="sig-name descname">SUPPORTED_ACTIVITIES</code><em class="property"> = {'IMPLND': [['IWATFG'], ['IWATER']], 'PERLND': [['PWATFG'], ['PWATER']], 'RCHRES': [['HYDRFG'], ['HYDR']]}</em><a class="headerlink" href="#locaMain.SUPPORTED_ACTIVITIES" title="Permalink to this definition">¶</a></dt>
<dd><p>Dictionary of supported activities</p>
</dd></dl>

<dl class="py data">
<dt id="locaMain.TARG_DICT">
<code class="sig-prename descclassname">locaMain.</code><code class="sig-name descname">TARG_DICT</code><em class="property"> = {}</em><a class="headerlink" href="#locaMain.TARG_DICT" title="Permalink to this definition">¶</a></dt>
<dd><p>Dictionary with target types as keys and list of target ids as values</p>
</dd></dl>

<dl class="py data">
<dt id="locaMain.TARG_IMPLND">
<code class="sig-prename descclassname">locaMain.</code><code class="sig-name descname">TARG_IMPLND</code><em class="property"> = 'IMPLND'</em><a class="headerlink" href="#locaMain.TARG_IMPLND" title="Permalink to this definition">¶</a></dt>
<dd><p>Key value for impervious land targets</p>
</dd></dl>

<dl class="py data">
<dt id="locaMain.TARG_PERVLND">
<code class="sig-prename descclassname">locaMain.</code><code class="sig-name descname">TARG_PERVLND</code><em class="property"> = 'PERLND'</em><a class="headerlink" href="#locaMain.TARG_PERVLND" title="Permalink to this definition">¶</a></dt>
<dd><p>Key value for pervious land targets</p>
</dd></dl>

<dl class="py data">
<dt id="locaMain.TARG_RCHRES">
<code class="sig-prename descclassname">locaMain.</code><code class="sig-name descname">TARG_RCHRES</code><em class="property"> = 'RCHRES'</em><a class="headerlink" href="#locaMain.TARG_RCHRES" title="Permalink to this definition">¶</a></dt>
<dd><p>Key value for reach/reservoir targets</p>
</dd></dl>

<dl class="py function">
<dt id="locaMain.WriteQueueCheckToLog">
<code class="sig-prename descclassname">locaMain.</code><code class="sig-name descname">WriteQueueCheckToLog</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">qMF6</span></em><span class="sig-paren">)</span><a class="headerlink" href="#locaMain.WriteQueueCheckToLog" title="Permalink to this definition">¶</a></dt>
<dd><p>Write queue checks to log file</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>qMF6</strong> (<em>Queue</em>) – the from MODFLOW6 queue</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>function status; 0 == success</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="locaMain.checkOpsSpec">
<code class="sig-prename descclassname">locaMain.</code><code class="sig-name descname">checkOpsSpec</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">allops</span></em>, <em class="sig-param"><span class="n">ucs</span></em>, <em class="sig-param"><span class="n">hdfType</span></em><span class="sig-paren">)</span><a class="headerlink" href="#locaMain.checkOpsSpec" title="Permalink to this definition">¶</a></dt>
<dd><p>Checks the activities and operations desired and creates lists of
target types.</p>
<p>Currently only PWATFG for PERLND, IWATFG for IMPLND, and HYDR
for RCHRES are supported. Before going through the time and
operations loops warn the user that only these will be implemented</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>allops</strong> (<em>np.recarray</em>) – operations listing from locaHSP2HDF5</p></li>
<li><p><strong>ucs</strong> (<em>dict</em>) – user control dictionary from locaHSP2HDF5</p></li>
<li><p><strong>hdfType</strong> (<em>int</em>) – type of HDF5 file; 0 == original format; 1 == new format</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>function status; 0 == success</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="locaMain.getDailySimTimeIndex">
<code class="sig-prename descclassname">locaMain.</code><code class="sig-name descname">getDailySimTimeIndex</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#locaMain.getDailySimTimeIndex" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the daily simulation time index from the SIMTIME_INDEXES
dictionary.</p>
<p>Must be called after setSimTimeIndexes</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>daily simulation time series index</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>pd.datetimeindex</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="locaMain.getTARG_DICT">
<code class="sig-prename descclassname">locaMain.</code><code class="sig-name descname">getTARG_DICT</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#locaMain.getTARG_DICT" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the global target dictionary.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>TARG_DICT</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="locaMain.initAllocTargStructures">
<code class="sig-prename descclassname">locaMain.</code><code class="sig-name descname">initAllocTargStructures</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">sim_len</span></em><span class="sig-paren">)</span><a class="headerlink" href="#locaMain.initAllocTargStructures" title="Permalink to this definition">¶</a></dt>
<dd><p>Initialize all target structures including time series,
flags, parameters, and initial values.</p>
<p>This takes care of initializing or allocating the simulation
memory by creating np.recarrays of the simulation length.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>sim_len</strong> (<em>int</em>) – number of time steps in the simulation</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>function status; 0 == success</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="locaMain.mainTL">
<code class="sig-prename descclassname">locaMain.</code><code class="sig-name descname">mainTL</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">sim_len</span></em>, <em class="sig-param"><span class="n">tIndex</span></em>, <em class="sig-param"><span class="n">qHSP2</span></em>, <em class="sig-param"><span class="n">qMF6</span></em>, <em class="sig-param"><span class="n">hdfTyper</span></em><span class="sig-paren">)</span><a class="headerlink" href="#locaMain.mainTL" title="Permalink to this definition">¶</a></dt>
<dd><p>The main time loop for mHSP2 in the coupled program.</p>
<p>Currently only 1440.0 minutes, or daily, is supported for
sim_delt or a daily time step.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>sim_len</strong> (<em>int</em>) – number of daily time steps in the simulation</p></li>
<li><p><strong>tIndex</strong> (<em>pd.datetimeseries</em>) – daily time index for simulation</p></li>
<li><p><strong>qHSP2</strong> (<em>Queue client</em>) – from HSP2 queue</p></li>
<li><p><strong>qMF6</strong> (<em>Queue client</em>) – from MODFLOW 6 queue</p></li>
<li><p><strong>hdfTyper</strong> (<em>int</em>) – type of HDF5 file; 0 == original format;0
1 == new format</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>function status, 0 == success</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="locaMain.metaChecks">
<code class="sig-prename descclassname">locaMain.</code><code class="sig-name descname">metaChecks</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">start_dt</span></em>, <em class="sig-param"><span class="n">end_dt</span></em>, <em class="sig-param"><span class="n">num_pl</span></em>, <em class="sig-param"><span class="n">num_il</span></em>, <em class="sig-param"><span class="n">num_rr</span></em><span class="sig-paren">)</span><a class="headerlink" href="#locaMain.metaChecks" title="Permalink to this definition">¶</a></dt>
<dd><p>Check the remaining meta data items passed from the queue
server as part of initial setup of a coupled simulation.</p>
<p>Requires that the input HDF5 file has already been read
and processed into program structures.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>start_dt</strong> (<em>dt.datetime</em>) – starting date time</p></li>
<li><p><strong>end_dt</strong> (<em>dt.datetime</em>) – ending date time</p></li>
<li><p><strong>num_pl</strong> (<em>int</em>) – number of PERLND</p></li>
<li><p><strong>num_il</strong> (<em>int</em>) – number of IMPLND</p></li>
<li><p><strong>num_rr</strong> (<em>int</em>) – number of RCHRES</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>function status; 0 == success</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py data">
<dt id="locaMain.nKEY_ACT_IWAT">
<code class="sig-prename descclassname">locaMain.</code><code class="sig-name descname">nKEY_ACT_IWAT</code><em class="property"> = 'IWATER'</em><a class="headerlink" href="#locaMain.nKEY_ACT_IWAT" title="Permalink to this definition">¶</a></dt>
<dd><p>New HDF5 format, key value for simulating standard impervious
water runoff</p>
</dd></dl>

<dl class="py data">
<dt id="locaMain.nKEY_ACT_PWAT">
<code class="sig-prename descclassname">locaMain.</code><code class="sig-name descname">nKEY_ACT_PWAT</code><em class="property"> = 'PWATER'</em><a class="headerlink" href="#locaMain.nKEY_ACT_PWAT" title="Permalink to this definition">¶</a></dt>
<dd><p>New HDF5 format, key value for simulating standard pervious
water runoff</p>
</dd></dl>

<dl class="py data">
<dt id="locaMain.nKEY_ACT_RRHYD">
<code class="sig-prename descclassname">locaMain.</code><code class="sig-name descname">nKEY_ACT_RRHYD</code><em class="property"> = 'HYDR'</em><a class="headerlink" href="#locaMain.nKEY_ACT_RRHYD" title="Permalink to this definition">¶</a></dt>
<dd><p>New HDF5 format, key value for simulating HYDR portion of reach
reservoirs</p>
</dd></dl>

<dl class="py function">
<dt id="locaMain.processArrayComm">
<code class="sig-prename descclassname">locaMain.</code><code class="sig-name descname">processArrayComm</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">iI</span></em>, <em class="sig-param"><span class="n">NpArray</span></em><span class="sig-paren">)</span><a class="headerlink" href="#locaMain.processArrayComm" title="Permalink to this definition">¶</a></dt>
<dd><p>Process the array communication from MODFLOW 6.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>iI</strong> (<em>int</em>) – current day, 0-based in the simulation</p></li>
<li><p><strong>NpArray</strong> (<em>np.array</em>) – the array of discharge to the surface from
MODFLOW 6</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>function status; success == 0</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="locaMain.processInitMeta">
<code class="sig-prename descclassname">locaMain.</code><code class="sig-name descname">processInitMeta</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">PassList</span></em><span class="sig-paren">)</span><a class="headerlink" href="#locaMain.processInitMeta" title="Permalink to this definition">¶</a></dt>
<dd><p>Process the initial metadata communication received from the
queue server.</p>
<p>Call the various routines as required to read in all of the HDF5
information as required to completely set up the model and check
start time, end time, number of pervious, number of impervious,
and number of reach res</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>PassList</strong> (<em>list</em>) – list, L, of items - these are pickled and</p></li>
<li><p><strong>and following formats are required.</strong> (<em>unpickled</em>) – <ol class="arabic simple" start="0">
<li><p>(str): model directory</p></li>
<li><p>(str): FQDN pathname for HDF5 input file</p></li>
<li><p>(dt.datetime): start time</p></li>
<li><p>(dt.datetime): end time</p></li>
<li><p>(int): number of PERLND</p></li>
<li><p>(int): number of IMPLND</p></li>
<li><p>(int): number of RCHRES</p></li>
<li><p>(int): number of 2D cells, NCPL in MF6</p></li>
<li><p>(str): FQDN pathname for RCHRES mapping dictionary</p></li>
<li><p>(str): FQDN pathname for PERLND mapping dictionary</p></li>
<li><p>(int): number of UZF cells in MF6</p></li>
<li><p>(str): FQDN pathname for SPRING mapping dictionary</p></li>
</ol>
</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><p>two items that provide the necessary information for
continuing the simulation.</p>
<blockquote>
<div><p>0. (int): return status; needs to be a member of <em>hdfTyper</em> -
0 or 1 for a success status</p>
<p>1. (str): hdfname - FQDN path for simulation HDF5 file. Empty
string for error.</p>
</div></blockquote>
</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>tuple</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="locaMain.processReadyComm">
<code class="sig-prename descclassname">locaMain.</code><code class="sig-name descname">processReadyComm</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">StringList</span></em><span class="sig-paren">)</span><a class="headerlink" href="#locaMain.processReadyComm" title="Permalink to this definition">¶</a></dt>
<dd><p>Process the ready communication with external processes.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>StringList</strong> (<em>list</em>) – list of string items</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>function status; success == 0</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="locaMain.salocaMain">
<code class="sig-prename descclassname">locaMain.</code><code class="sig-name descname">salocaMain</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">simdir</span></em>, <em class="sig-param"><span class="n">hdfname</span></em>, <em class="sig-param"><span class="n">saveall</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">reloadkeys</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="headerlink" href="#locaMain.salocaMain" title="Permalink to this definition">¶</a></dt>
<dd><p>Runs main HSP2 program in standalone mode.</p>
<p>Rewrite of original to make one main time loop</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>simdir</strong> (<em>str</em>) – verified model simulaton directory</p></li>
<li><p><strong>hdfname</strong> (<em>str</em>) – HDF5 filename used for both input and output.</p></li>
<li><p><strong>saveall</strong> (<em>bool</em>) – Saves all calculated data ignoring SAVE tables.</p></li>
<li><p><strong>reloadkeys</strong> (<em>bool</em>) – Regenerates keys, used after adding new modules.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>function status, 0 == success</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="locaMain.setFlowLinks">
<code class="sig-prename descclassname">locaMain.</code><code class="sig-name descname">setFlowLinks</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">linkdd</span></em>, <em class="sig-param"><span class="n">mldd</span></em>, <em class="sig-param"><span class="n">hdfType</span></em><span class="sig-paren">)</span><a class="headerlink" href="#locaMain.setFlowLinks" title="Permalink to this definition">¶</a></dt>
<dd><p>Setup the link structues, or routing, among targets.</p>
<p>This requires a combination of the defined mass links
and schematic defined in the UCI file and ported to the
HDF5 file.</p>
<p>At this point only linkages among “flow” types: PERLND; IMPLAND;
and RCHRES are supported. Note that only RCHRES is supported as
a receiving target - this means that a usable mass link and
schematic link can only have RCHRES as the TVOL and that
PERLND and IMPLAND can never be the TVOL.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>linkdd</strong> (<em>dict</em>) – dictionary with schematic linkage among
targets</p></li>
<li><p><strong>mldd</strong> (<em>dict</em>) – mass link definitions</p></li>
<li><p><strong>hdfType</strong> – type of HDF5 file; 0 == original format;
1 == new format</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="locaMain.setHRUAreas">
<code class="sig-prename descclassname">locaMain.</code><code class="sig-name descname">setHRUAreas</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">linkdd</span></em><span class="sig-paren">)</span><a class="headerlink" href="#locaMain.setHRUAreas" title="Permalink to this definition">¶</a></dt>
<dd><p>Extract the HRU surface areas and store for post-processing.</p>
<p>This involves setting the areas for PERLND and IMPLND. These
are only stored in the SCHEMATIC and LINKS sections of the
inputs as the area factor or AFACTOR. So have to process through
this linkdd which is ordered by reach to extract these values</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>linkdd</strong> (<em>dict</em>) – dictionary of links with reaches as keys</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>function status; 0 == success</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="locaMain.setOutputSave">
<code class="sig-prename descclassname">locaMain.</code><code class="sig-name descname">setOutputSave</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">ucs</span></em>, <em class="sig-param"><span class="n">hdfType</span></em><span class="sig-paren">)</span><a class="headerlink" href="#locaMain.setOutputSave" title="Permalink to this definition">¶</a></dt>
<dd><p>Extract the save specifications from the hdf5 storage structures
and send to the target modules.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ucs</strong> (<em>dict</em>) – user control dictionary from locaHSP2HDF5</p></li>
<li><p><strong>hdfType</strong> (<em>int</em>) – type of HDF5 file; 0 == original format;
1 == new format</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>function status; 0 == success</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="locaMain.setParmsFlagsUCS">
<code class="sig-prename descclassname">locaMain.</code><code class="sig-name descname">setParmsFlagsUCS</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">sim_delt</span></em>, <em class="sig-param"><span class="n">ucs</span></em>, <em class="sig-param"><span class="n">hdfType</span></em><span class="sig-paren">)</span><a class="headerlink" href="#locaMain.setParmsFlagsUCS" title="Permalink to this definition">¶</a></dt>
<dd><p>Transfer the parameter values and flags from the hdf file to
our target modules.</p>
<p>Currently only “PWATFG”, “IWATFG”, and “HYDRFG” are supported. Note
that these names have changed slightly under the new HDF5 file format
and both naming conventions are supported.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>sim_delt</strong> (<em>float</em>) – time step duration</p></li>
<li><p><strong>ucs</strong> (<em>dict</em>) – user control dictionary from locaHSP2HDF5</p></li>
<li><p><strong>hdfType</strong> (<em>int</em>) – type of HDF5 file; 0 == original format;
1 == new format</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>function status; 0 == success</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="locaMain.setSimTimeIndexes">
<code class="sig-prename descclassname">locaMain.</code><code class="sig-name descname">setSimTimeIndexes</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">allops</span></em>, <em class="sig-param"><span class="n">general</span></em>, <em class="sig-param"><span class="n">hdfType</span></em><span class="sig-paren">)</span><a class="headerlink" href="#locaMain.setSimTimeIndexes" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets the simulation time indexes from operational sequence in the
hdf5 file.</p>
<p>At this time are only excepting daily time steps so this is all that
will be returned. If a daily time step is not specified in the
operational sequence, then an error will be thrown.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>allops</strong> (<em>np.recarray</em>) – operations listing from locaHSP2HDF5</p></li>
<li><p><strong>general</strong> (<em>dict</em>) – GENERAL dictionary from locaHSP2HDF5</p></li>
<li><p><strong>hdfType</strong> (<em>int</em>) – type of HDF5 file; 0 == original format; 1 == new format</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>function status; 0 == success</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="locaMain.setTargDataTS">
<code class="sig-prename descclassname">locaMain.</code><code class="sig-name descname">setTargDataTS</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">sim_len</span></em><span class="sig-paren">)</span><a class="headerlink" href="#locaMain.setTargDataTS" title="Permalink to this definition">¶</a></dt>
<dd><p>Set the input time series into the target structures.</p>
<p><strong>Note</strong> that this only works with daily simulation time steps
Time steps are stored in minutes so this should always be
1440.0 minutes or 1 day.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>sim_len</strong> (<em>int</em>) – number of time steps in the simulation</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>function status; 0 == success</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="locaMain.setUPPreTL">
<code class="sig-prename descclassname">locaMain.</code><code class="sig-name descname">setUPPreTL</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">hdfname</span></em>, <em class="sig-param"><span class="n">saveall</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">reloadkeys</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="headerlink" href="#locaMain.setUPPreTL" title="Permalink to this definition">¶</a></dt>
<dd><p>Does all of the main mHSP2 setup for a coupled simulation.</p>
<p>Called prior to starting the main, time, loop.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>hdfname</strong> (<em>str</em>) – HDF5 filename used for both input and output.</p></li>
<li><p><strong>saveall</strong> (<em>bool</em>) – Saves all calculated data ignoring SAVE tables.</p></li>
<li><p><strong>reloadkeys</strong> (<em>bool</em>) – Regenerates keys, used after adding new modules.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><dl class="simple">
<dt>function status; also needs to be one of the <em>hdfTyper</em></dt><dd><p>supported values, [0,1]; successful execution of this
function means that either 0 or 1 is returned.</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="locaMain.writeOutputs">
<code class="sig-prename descclassname">locaMain.</code><code class="sig-name descname">writeOutputs</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">hdfname</span></em>, <em class="sig-param"><span class="n">tIndex</span></em>, <em class="sig-param"><span class="n">hdfType</span></em><span class="sig-paren">)</span><a class="headerlink" href="#locaMain.writeOutputs" title="Permalink to this definition">¶</a></dt>
<dd><p>Write out the outputs at the end of the simulation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>hdfname</strong> (<em>str</em>) – HDF5 file to output to</p></li>
<li><p><strong>hdfType</strong> (<em>int</em>) – type of HDF5 file; 0 == original format;
1 == new format</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>function status; success == 0</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
        </div>
        <div class="sidebar">
          
          <h3>Table of Contents</h3>
          <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">1. Getting Started with pyHS2MF6</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">2. Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="case_study.html">3. Coupled Mode Example Model</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="code_doc.html">4. Code Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="cpcontroller.html">4.1. Coupled Model Controller and Queue Server</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="mHSP2.html">4.2. mHSP2</a></li>
<li class="toctree-l2"><a class="reference internal" href="pyMF6.html">4.3. pyMF6</a></li>
</ul>
</li>
</ul>

          <div role="search">
            <h3 style="margin-top: 1.5em;">Search</h3>
            <form class="search" action="search.html" method="get">
                <input type="text" name="q" />
                <input type="submit" value="Go" />
            </form>
          </div>

        </div>
        <div class="clearer"></div>
      </div>
    </div>

    <div class="footer-wrapper">
      <div class="footer">
        <div class="left">
          <div role="navigation" aria-label="related navigaton">
            <a href="mHSP2.html" title="4.2. mHSP2"
              >previous</a> |
            <a href="mHSP2_hrchhyd.html" title="4.2.2. RCHRES Water Movement and Storage"
              >next</a> |
            <a href="py-modindex.html" title="Python Module Index"
              >modules</a> |
            <a href="f-modindex.html" title="Fortran Module Index"
              >fortran modules</a> |
            <a href="genindex.html" title="General Index"
              >index</a>
          </div>
          <div role="note" aria-label="source link">
              <br/>
              <a href="_sources/mHSP2_main.rst.txt"
                rel="nofollow">Show Source</a>
          </div>
        </div>

        <div class="right">
          
    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, Nick Martin.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.1.2.
    </div>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

  </body>
</html>